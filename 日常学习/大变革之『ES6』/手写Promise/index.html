<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script type="text/javascript">
      class myPromise {
        constructor(executor) {
          this.state = "pending";
          this.value = undefined;
          this.reason = undefined;
          this.onFullFilledCallbacks = [];
          this.onRejectedCallbacks = [];

          let resolve = (value) => {
            this.state = "fullFilled";
            this.value = value;

            this.onFullFilledCallbacks.forEach((fn) => fn());
          };
          let reject = (reason) => {
            this.state = "rejected";
            this.reason = reason;

            this.onRejectedCallbacks.forEach((fn) => fn());
          };

          executor(resolve, reject);
        }
        then(onFullFilled, onRejected) {
          const p2 = new myPromise((resolve, reject) => {
            let x;

            if (this.state === "fullFilled") onFullFilled(this.value);
            if (this.state === "rejected") onRejected(this.reason);
            if (this.state === "pending") {
              this.onFullFilledCallbacks.push(() => {
                x = onFullFilled(this.value);
                resolve(x);
              });
              this.onRejectedCallbacks.push(() => {
                onRejected(this.reason);
              });
            }
          });

          return p2;
        }
      }

      const p = new myPromise((resolve, reject) => {
        setTimeout(() => {
          resolve(1);
        }, 1000);
      });
      const p2 = p.then((res) => {
        console.log(res);
        return res + 1;
      });
      p2.then((res) => {
        console.log(res);
      });
    </script>
  </body>
</html>
